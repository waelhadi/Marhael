import marshal

# كلمة السر المطلوبة لتشغيل الأداة
PASSWORD = "NASR"

# دالة فك التشفير
def فك_التشفير(اسم_الملف_المضغوط, اسم_الملف_الخارج):
    # قراءة الكود المضغوط من الملف
    with open(اسم_الملف_المضغوط, "r", encoding="utf-8") as file:
        الكود_المضغوط = file.read()
    
    # استخراج البيانات من النص (التخلص من "exec(__import__('marshal').loads(...))")
    بداية = الكود_المضغوط.find("loads(") + len("loads(")
    نهاية = الكود_المضغوط.rfind("))")
    البيانات_المشفرة = eval(الكود_المضغوط[بداية:نهاية])
    
    # فك التشفير حتى الوصول إلى الكود الأصلي
    while isinstance(البيانات_المشفرة, bytes):
        البيانات_المشفرة = marshal.loads(البيانات_المشفرة)
    
    # حفظ الكود المفكوك في الملف الناتج
    with open(اسم_الملف_الخارج, "w", encoding="utf-8") as file:
        file.write(البيانات_المشفرة)
    
    print(f"تم فك التشفير وحفظ الكود الأصلي في '{اسم_الملف_الخارج}'.")

if __name__ == "__main__":
    print("=== أداة فك تشفير ملفات Python ===")
    كلمة_السر = input("أدخل كلمة السر لتشغيل الأداة: ").strip()

    # التحقق من كلمة السر
    if كلمة_السر != PASSWORD:
        print("كلمة السر غير صحيحة. لا يمكن تشغيل الأداة.")
    else:
        # تشغيل الأداة إذا كانت كلمة السر صحيحة
        اسم_الملف_المضغوط = input("أدخل اسم ملف Python المضغوط (مثال: compressed_script.py): ").strip()
        اسم_الملف_الخارج = input("أدخل اسم الملف الناتج (مثال: original_script.py): ").strip()

        فك_التشفير(اسم_الملف_المضغوط, اسم_الملف_الخارج)
